<app-navbar />
<div class="container mt-5 mb-5">
  <div class="card shadow-lg p-4">
    <h4 class="mb-4 text-center fw-bold">Daily Activity Process</h4>

    <!-- Step Progress with Icons -->
    <div
      class="d-flex justify-content-between align-items-center mb-3 position-relative"
    >
      <!-- Progress bar background -->
      <div
        class="position-absolute top-50 start-0 w-100 translate-middle-y bg-light"
        style="height: 6px; border-radius: 4px"
      ></div>

      <!-- Progress bar fill -->
      <div
        class="position-absolute top-50 start-0 translate-middle-y bg-primary"
        [style.width.%]="(step / 5) * 100"
        style="height: 6px; border-radius: 4px; transition: width 0.4s ease"
      ></div>

      <!-- Steps with icons -->
      <div
        *ngFor="let s of steps; let i = index"
        class="text-center position-relative"
        style="z-index: 1; flex: 1"
      >
        <div
          class="rounded-circle d-flex align-items-center justify-content-center mx-auto mb-5"
          [ngClass]="{
            'bg-primary text-white': step >= s.id,
            'bg-light text-secondary': step < s.id,
            'transformScale': step >= s.id,
            'transformScale0': step >= s.id + 1
          }"
          style="width: 40px; height: 40px"
        >
          <i [class]="s.icon"></i>
        </div>
        <small>{{ s.label }}</small>
      </div>
    </div>
    @defer(on timer(2000)){

    <div class="step-content mt-4">
      <!-- Step 1 -->
      <div *ngIf="step === 1">
        <h5>Select User</h5>
        <select class="form-select mt-3" [(ngModel)]="selectedUser">
          <option *ngFor="let user of users" [ngValue]="user">
            {{ user.username }}
          </option>
        </select>
      </div>

      <!-- Step 2 -->
      <div *ngIf="step === 2">
        <h5>Select Category</h5>
        <select class="form-select mt-3" [(ngModel)]="selectedCategory">
          <option *ngFor="let cat of categories" [ngValue]="cat">
            {{ cat.name }}
          </option>
        </select>
      </div>
      <!-- Step 3: Daily Log Form -->
      <div *ngIf="step === 3">
        <h5>Create Daily Log</h5>
        <div class="mt-3">
          <input
            class="form-control mb-2"
            placeholder="Mood"
            [(ngModel)]="dailyLogForm.mood"
            name="mood"
            required
            #moodInput="ngModel"
          />
          <div
            class="text-danger"
            *ngIf="moodInput.invalid && moodInput.touched"
          >
            Mood is required
          </div>

          <input
            class="form-control mb-2"
            placeholder="Top Wins (comma separated)"
            [(ngModel)]="dailyLogForm.topWins"
            name="topWins"
            maxlength="100"
          />
          <textarea
            class="form-control mb-2"
            placeholder="Notes"
            [(ngModel)]="dailyLogForm.notes"
            name="notes"
            maxlength="200"
          ></textarea>

          <input
            type="number"
            class="form-control mb-2"
            placeholder="Total Score (0-10)"
            [(ngModel)]="dailyLogForm.totalScore"
            name="totalScore"
            required
            min="0"
            max="10"
            #scoreInput="ngModel"
          />
          <div
            class="text-danger"
            *ngIf="scoreInput.invalid && scoreInput.touched"
          >
            Total Score is required and must be 0-10
          </div>
        </div>
      </div>
      <!-- Step 4: Activity Form -->
      <div *ngIf="step === 4">
        <h5>Create Activity</h5>
        <div class="mt-3">
          <input
            class="form-control mb-2"
            placeholder="Title"
            [(ngModel)]="activityForm.title"
            name="title"
            required
            #titleInput="ngModel"
          />
          <div
            class="text-danger"
            *ngIf="titleInput.invalid && titleInput.touched"
          >
            Title is required
          </div>

          <div class="d-flex gap-2">
            <input
              type="time"
              class="form-control mb-2"
              [(ngModel)]="activityForm.startTime"
              name="startTime"
            />
            <input
              type="time"
              class="form-control mb-2"
              [(ngModel)]="activityForm.endTime"
              name="endTime"
              #endTimeInput="ngModel"
            />
          </div>
          <div class="text-danger" *ngIf="activityTimeInvalid">
            End time must be after start time
          </div>

          <input
            type="number"
            class="form-control mb-2"
            placeholder="Duration (mins)"
            [(ngModel)]="activityForm.duration"
            name="duration"
            required
            min="1"
            #durationInput="ngModel"
          />
          <div
            class="text-danger"
            *ngIf="durationInput.invalid && durationInput.touched"
          >
            Duration is required and must be positive
          </div>

          <input
            class="form-control mb-2"
            placeholder="Energy"
            [(ngModel)]="activityForm.energy"
            name="energy"
          />

          <input
            type="number"
            class="form-control mb-2"
            placeholder="Rating (1-10)"
            [(ngModel)]="activityForm.rating"
            name="rating"
            required
            min="1"
            max="10"
            #ratingInput="ngModel"
          />
          <div
            class="text-danger"
            *ngIf="ratingInput.invalid && ratingInput.touched"
          >
            Rating is required and must be 1-10
          </div>

          <textarea
            class="form-control mb-2"
            placeholder="Note"
            [(ngModel)]="activityForm.note"
            name="note"
            maxlength="200"
          ></textarea>
        </div>
      </div>

      <!-- Step 5: Show Created Activity -->
      <div *ngIf="step === 5">
        <h5>Activity Created Successfully</h5>
        <div class="alert alert-success mt-3">
          <p><strong>Title:</strong> {{ createdActivity.title }}</p>
          <p>
            <strong>Daily Log Mood:</strong> {{ createdActivity.dailyLogId?.mood
            }}
          </p>
          <p>
            <strong>Category:</strong> {{ createdActivity.categoryId?._id }}
          </p>
          <p><strong>Duration:</strong> {{ createdActivity.duration }} mins</p>
          <p><strong>Energy:</strong> {{ createdActivity.energy }}</p>
          <p><strong>Rating:</strong> {{ createdActivity.rating }}</p>
          <p><strong>Note:</strong> {{ createdActivity.note }}</p>
        </div>
      </div>
    </div>
    <!-- Buttons -->
    <div class="d-flex justify-content-between mt-4">
      <button
        class="btn btn-outline-secondary"
        (click)="prevStep()"
        [disabled]="step === 1"
      >
        Back
      </button>
      <button class="btn btn-primary" (click)="nextStep()" *ngIf="step < 5">
        {{ step === 2 ? 'Next â†’ Daily Log' : step === 3 ? 'Create Daily Log' :
        step === 4 ? 'Create Activity' : 'Next' }}
      </button>
    </div>
    }@placeholder{
    <div class="d-flex justify-content-center align-items-center mt-4">
      <div
        class="spinner-border spinner-border-sm text-primary"
        role="status"
      ></div>
      <span class="ms-2">Loading...</span>
    </div>

    }
  </div>
</div>
